"""
–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±–æ—Ç–∞
"""

from aiogram import Bot
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from typing import List

import app.texts as txt


# ============================================================================
# –¢–ï–ö–°–¢–´ –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –û –ü–û–î–ü–ò–°–ö–ï
# ============================================================================

# –ó–∞ 1 –¥–µ–Ω—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
EXPIRING_1_DAY_TEXT = """–ó–∞–≤—Ç—Ä–∞ –ö–æ–º–Ω–∞—Ç–∞ –∑–∞–∫—Ä–æ–µ—Ç—Å—è ‚Äî
–Ω–æ —Ç—ã –º–æ–∂–µ—à—å –æ—Å—Ç–∞—Ç—å—Å—è.

–ö–∞–∂–¥—ã–π –º–µ—Å—è—Ü –∑–¥–µ—Å—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –ö–æ–º–Ω–∞—Ç–∞.

–ù–µ –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é ‚Äî
–ø–æ —Ç–≤–æ–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.

–¢—ã —Å–∞–º–∞ —Ä–µ—à–∞–µ—à—å, –∫–∞–∫–∞—è –æ–Ω–∞ –±—É–¥–µ—Ç.

–ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ —Ç–µ–±–µ –≤–∞–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Äî
—è –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–Ω—é, —á—Ç–æ –≤—Ö–æ–¥ –≤—Å—ë –µ—â—ë —Ä—è–¥–æ–º.

–ò —Ç—ã –Ω–µ –æ–¥–Ω–∞."""

# –í –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å)
EXPIRING_TODAY_TEXT = """–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ö–æ–º–Ω–∞—Ç—É –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å.

–Ø –Ω–µ –±—É–¥—É —à—É–º–µ—Ç—å.

–¢–æ–ª—å–∫–æ –æ—Å—Ç–∞–≤–ª—é —Ä—è–¥–æ–º –≤—Ö–æ–¥ ‚Äî –µ—Å–ª–∏ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.

–£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Å–≤–æ–π —Ä–∏—Ç–º. –Ø –Ω–µ –≤–º–µ—à–∏–≤–∞—é—Å—å.

–ü—Ä–æ—Å—Ç–æ —Ç–∏—Ö–æ –Ω–∞–ø–æ–º–∏–Ω–∞—é: –º–æ–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è. –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è. –ú–æ–∂–Ω–æ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ."""

# –ß–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è
EXPIRED_3_DAYS_TEXT = """–ò–Ω–æ–≥–¥–∞ –º—ã –≤—ã—Ö–æ–¥–∏–º –Ω–∞ —É–ª–∏—Ü—É –∏ –Ω–µ –∑–Ω–∞–µ–º, –≤–µ—Ä–Ω—ë–º—Å—è –ª–∏.

–ò–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ç–æ –∂–µ –º–µ—Å—Ç–æ ‚Äî –∏ —á—É–≤—Å—Ç–≤—É–µ–º –µ–≥–æ —Å–æ–≤—Å–µ–º –∏–Ω–∞—á–µ.

–¢–≤–æ—è –ö–æ–º–Ω–∞—Ç–∞ –≤—Å—ë –µ—â—ë –∑–¥–µ—Å—å.

–ï—Å–ª–∏ –æ–Ω–∞ —Ç–µ–±–µ —Å–µ–π—á–∞—Å –Ω–µ –Ω—É–∂–Ω–∞ ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –æ—Ç–≤–µ—Ç.

–ù–æ –µ—Å–ª–∏ –≤–¥—Ä—É–≥ ‚Äî —è –æ—Å—Ç–∞–≤–ª—è—é –∫–∞—Å–∞–Ω–∏–µ."""

# –ß–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è
EXPIRED_7_DAYS_TEXT = """–î–∞–∂–µ –µ—Å–ª–∏ –ö–æ–º–Ω–∞—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ –∑–æ–≤—ë—Ç ‚Äî –æ–Ω–∞ –±—ã–ª–∞.

–ò —Ç—ã –±—ã–ª–∞ –≤ –Ω–µ–π.

–≠—Ç–æ —É–∂–µ —Å–ª—É—á–∏–ª–æ—Å—å.

–Ø –Ω–µ –ø–æ–∑–æ–≤—É –±–æ–ª—å—à–µ. –ü—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–ª—é –≤—Ö–æ–¥.

–ï—Å–ª–∏ –æ—Ç–∫–ª–∏–∫–Ω–µ—Ç—Å—è ‚Äî –º–æ–∂–µ—à—å –Ω–∞–∂–∞—Ç—å."""


# ============================================================================
# –ö–õ–ê–í–ò–ê–¢–£–†–´ –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
# ============================================================================

def get_expiring_1_day_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∑–∞ 1 –¥–µ–Ω—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è"""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text='–ü—Ä–æ–¥–ª–∏—Ç—å –¥–æ—Å—Ç—É–ø', callback_data='renew_subscription')],
        [InlineKeyboardButton(text='–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–≤—É—é –ö–æ–º–Ω–∞—Ç—É', callback_data='go_to_room_entrance')],
        [InlineKeyboardButton(text='–ù–∞–∑–∞–¥', callback_data='back_to_main')]
    ])


def get_expiring_today_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤ –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è"""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text='–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ –º–µ—Å—è—Ü', callback_data='renew_subscription')],
        [InlineKeyboardButton(text='–ù–∞–∑–∞–¥', callback_data='back_to_main')]
    ])


def get_expired_3_days_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è"""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text='–ü—Ä–æ–¥–ª–∏—Ç—å –¥–æ—Å—Ç—É–ø', callback_data='renew_subscription')],
        [InlineKeyboardButton(text='–ù–∞–∑–∞–¥', callback_data='back_to_main')]
    ])


def get_expired_7_days_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–ø–æ—Å–ª–µ–¥–Ω–µ–µ)"""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text='–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ–º–Ω–∞—Ç—É', callback_data='go_to_room_entrance')],
        [InlineKeyboardButton(text='–ù–∞–∑–∞–¥', callback_data='back_to_main')]
    ])


# ============================================================================
# –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –ü–õ–ê–¢–ï–ñ–ê–•
# ============================================================================

async def notify_payment_processed(bot: Bot, user_id: int) -> bool:
    """
    –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–ø–ª–∞—Ç—ã
    """
    try:
        await bot.send_message(
            chat_id=user_id,
            text=txt.PAYMENT_PROCESSED_NOTIFICATION
        )
        print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
        return False


async def notify_multiple_users(bot: Bot, user_ids: List[int], text: str) -> dict:
    """
    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    """
    success = 0
    failed = 0

    for user_id in user_ids:
        try:
            await bot.send_message(chat_id=user_id, text=text)
            success += 1
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
            failed += 1

    print(f"üìä –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: —É—Å–ø–µ—à–Ω–æ {success}, –æ—à–∏–±–æ–∫ {failed}")
    return {'success': success, 'failed': failed}


# ============================================================================
# –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –ü–û–î–ü–ò–°–ö–ê–•
# ============================================================================

async def notify_expiring_1_day(bot: Bot, user_id: int) -> bool:
    """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"""
    try:
        await bot.send_message(
            chat_id=user_id,
            text=EXPIRING_1_DAY_TEXT,
            reply_markup=get_expiring_1_day_keyboard()
        )
        print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (1 –¥–µ–Ω—å –¥–æ) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
        return False


async def notify_expiring_today(bot: Bot, user_id: int) -> bool:
    """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"""
    try:
        await bot.send_message(
            chat_id=user_id,
            text=EXPIRING_TODAY_TEXT,
            reply_markup=get_expiring_today_keyboard()
        )
        print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
        return False


async def notify_expired_3_days(bot: Bot, user_id: int) -> bool:
    """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"""
    try:
        await bot.send_message(
            chat_id=user_id,
            text=EXPIRED_3_DAYS_TEXT,
            reply_markup=get_expired_3_days_keyboard()
        )
        print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (3 –¥–Ω—è –ø–æ—Å–ª–µ) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
        return False


async def notify_expired_7_days(bot: Bot, user_id: int) -> bool:
    """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–ø–æ—Å–ª–µ–¥–Ω–µ–µ)"""
    try:
        await bot.send_message(
            chat_id=user_id,
            text=EXPIRED_7_DAYS_TEXT,
            reply_markup=get_expired_7_days_keyboard()
        )
        print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (7 –¥–Ω–µ–π –ø–æ—Å–ª–µ, –ø–æ—Å–ª–µ–¥–Ω–µ–µ) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
        return False
